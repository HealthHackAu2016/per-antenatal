<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Antenatal IRS - Antenatal Required Tests</title>
    <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/wizard.css">
  </head>
  <body>
    <div class="container">
      <div class="row">
        <section>
          <div class="wizard">
            <div class="wizard-inner">
              <div class="connecting-line"></div>
              <ul class="nav nav-tabs" role="tablist">

                <li role="presentation" class="disabled">
                  <a href="#step1" data-toggle="tab" aria-controls="step1" role="tab" title="Step 1">
                    <span class="round-tab">
                                  <i class="glyphicon glyphicon-folder-open"></i>
                              </span>
                  </a>
                </li>

                <li role="presentation" class="disabled">
                  <a href="#step2" data-toggle="tab" aria-controls="step2" role="tab" title="Step 2">
                    <span class="round-tab">
                                  <i class="glyphicon glyphicon-pencil"></i>
                              </span>
                  </a>
                </li>
                <li role="presentation" class="disabled">
                  <a href="#step3" data-toggle="tab" aria-controls="step3" role="tab" title="Step 3">
                    <span class="round-tab">
                                  <i class="glyphicon glyphicon-picture"></i>
                              </span>
                  </a>
                </li>

                <li role="presentation" class="active">
                  <a href="#complete" data-toggle="tab" aria-controls="complete" role="tab" title="Complete">
                    <span class="round-tab">
                                  <i class="glyphicon glyphicon-ok"></i>
                              </span>
                  </a>
                </li>
              </ul>
            </div>
            <form id="screen-four" action="" method="post" role="form">
              <div class="panel-group panel-primary">
              <div class="panel-heading">Antenatal Required Tests</div>
              <div class="panel-body">

                <div class="well">If not available please provide reason.</div>

                <div class="panel panel-default">
                  <div class="panel-heading">Ultrasound Tests</div>
                  <div class="panel-body">
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="dating-scan">Dating scan</label>
                        <input type="file" id="dating-scan" class="form-control" name="dating-scan">
                      </div>
                      <div class="col-xs-8">
                        <label for="dating-scan-reason"><small>Reason</small></label>
                        <input id="dating-scan-reason" class="form-control" name="dating-scan-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="first-trimester-screening">First trimester screening (11-14 weeks)</label>
                        <input type="file" id="first-trimester-screening" class="form-control" name="first-trimester-screening">
                      </div>
                      <div class="col-xs-8">
                        <label for="first-trimester-screening-reason"><small>Reason</small></label>
                        <input id="first-trimester-screening-reason" class="form-control" name="first-trimester-screening-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="anatomy-scan">Anatomy scan (18-22 weeks)</label>
                        <input type="file" id="anatomy-scan" class="form-control" name="anatomy-scan">
                      </div>
                      <div class="col-xs-8">
                        <label for="anatomy-scan-reason"><small>Reason</small></label>
                        <input id="anatomy-scan-reason" class="form-control" name="anatomy-scan-reason">
                      </div>
                    </div>
                  </div>
                </div>

                <br/>

                <div class="panel panel-default">
                  <div class="panel-heading">Pathology Tests</div>
                  <div class="panel-body">
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="full-blood-count">Full blood count</label>
                        <input type="file" id="full-blood-count" class="form-control" name="full-blood-count">
                      </div>
                      <div class="col-xs-8">
                        <label for="full-blood-count-reason"><small>Reason</small></label>
                        <input id="full-blood-count-reason" class="form-control" name="full-blood-count-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="blood-group-antibodies">Blood group antibodies</label>
                        <input type="file" id="blood-group-antibodies" class="form-control" name="blood-group-antibodies">
                      </div>
                      <div class="col-xs-8">
                        <label for="blood-group-antibodies-reason"><small>Reason</small></label>
                        <input id="blood-group-antibodies-reason" class="form-control" name="blood-group-antibodies-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="chlamydia">Chlamydia</label>
                        <input type="file" id="chlamydia" class="form-control" name="chlamydia">
                      </div>
                      <div class="col-xs-8">
                        <label for="chlamydia-reason"><small>Reason</small></label>
                        <input id="chlamydia-reason" class="form-control" name="chlamydia-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="hepatitis-b-c">Hepatitis B and C</label>
                        <input type="file" id="hepatitis-b-c" class="form-control" name="hepatitis-b-c">
                      </div>
                      <div class="col-xs-8">
                        <label for="hepatitis-b-c-reason"><small>Reason</small></label>
                        <input id="hepatitis-b-c-reason" class="form-control" name="hepatitis-b-c-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="hiv">HIV</label>
                        <input type="file" id="hiv" class="form-control" name="hiv">
                      </div>
                      <div class="col-xs-8">
                        <label for="hiv-reason"><small>Reason</small></label>
                        <input id="hiv-reason" class="form-control" name="hiv-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="syphilis">Syphilis</label>
                        <input type="file" id="syphilis" class="form-control" name="syphilis">
                      </div>
                      <div class="col-xs-8">
                        <label for="syphilis-reason"><small>Reason</small></label>
                        <input id="syphilis-reason" class="form-control" name="syphilis-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="rubella-titre">Rubella Titre</label>
                        <input type="file" id="rubella-titre" class="form-control" name="rubella-titre">
                      </div>
                      <div class="col-xs-8">
                        <label for="rubella-titre-reason"><small>Reason</small></label>
                        <input id="rubella-titre-reason" class="form-control" name="rubella-titre-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="varicella">Varicella</label>
                        <input type="file" id="varicella" class="form-control" name="varicella">
                      </div>
                      <div class="col-xs-8">
                        <label for="varicella-reason"><small>Reason</small></label>
                        <input id="varicella-reason" class="form-control" name="varicella-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="vitamin-d-level">Vitamin D Levels</label>
                        <input type="file" id="vitamin-d-level" class="form-control" name="vitamin-d-level">
                      </div>
                      <div class="col-xs-8">
                        <label for="vitamin-d-level-reason"><small>Reason</small></label>
                        <input id="vitamin-d-level-reason" class="form-control" name="vitamin-d-level-reason">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-xs-4">
                        <label for="midstream-urine">Midstream Urine</label>
                        <input type="file" id="midstream-urine" class="form-control" name="midstream-urine">
                      </div>
                      <div class="col-xs-8">
                        <label for="midstream-urine-reason"><small>Reason</small></label>
                        <input id="midstream-urine-reason" class="form-control" name="midstream-urine-reason">
                      </div>
                    </div>
                  </div>
                </div>

                <br/>

                <button type="submit" class="btn btn-default">Back</button>
                <button type="submit" class="btn btn-primary pull-right">Complete</button>
              </div>
            </form>
          </div>
        </section>
      </div>
    </div>
  </body>

  <script>
var fs = require('fs'); // Load the File System to execute our common tasks (CRUD)
const jQuery = require('jquery');
var $ = jQuery;
require('bootstrap');

$(function(){
  console.log( "ready!" );
  $('#LanguageRow').hide();

  $('#Interpreter').change(function(){
    $('#LanguageRow').hide();
      if($('#Interpreter').val() === 'Yes' ){
        $('#LanguageRow').show();
      }
  });

  $.fn.serializeObject = function() {
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
  };

  function save(){
    var fileName = "screen_four"; //TODO folder 
    var fieldObject = $('form').serializeObject();

    $('input:file').each(function() {
      if ($(this).val()) {
        var rd = fs.createReadStream(this.files[0].path);
        var wr = fs.createWriteStream('tmp_files/'+$(this).attr('name')+'.pdf');
        rd.pipe(wr);
        fieldObject[$(this).attr('name')] = 'tmp_files/'+$(this).attr('name')+'.pdf';
      } else {
        fieldObject[$(this).attr('name')] = '';
      }
    });

    var content = JSON.stringify(fieldObject);

    fs.writeFile(fileName, content, function (err) {
      if(err) {
        alert("An error ocurred creating the file "+ err.message)
      }        
      alert("The file has been succesfully saved");
    });
  }

  function validation(){
    return true;
  }

  $('form').submit(function(e) {
    if(!validation()){
      console.log('error');
    }
    console.log('save');
    save();
    return false;
  });

});
  </script>
</html>

